<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Cal Poly Radiation Map</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>

<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>

    <script>
var map, layer1, layer2;

var minlat = 35.14;
var minlng = -120.92;
var celldivisions = 20;
var cellwidth = 0.02;
var cellheight = 0.018;
var latarray = [minlat];
var lngarray = [minlng];
var cellarray = [];
var markerarray = [];
var play;

function createGrid() {
	for(var i=1;i<=celldivisions;i++)
	{
		var thislat = minlat+cellheight*i;
		latarray.push(thislat);
		var thislng = minlng+cellwidth*i;
		lngarray.push(thislng);
	}

	for(var i=0;i<celldivisions;i++)
	{
		for(var j=0;j<celldivisions;j++)
		{
			var polygonCoords = [
				new google.maps.LatLng(latarray[i], lngarray[j]),
				new google.maps.LatLng(latarray[i], lngarray[j+1]),
				new google.maps.LatLng(latarray[i+1], lngarray[j+1]),
				new google.maps.LatLng(latarray[i+1], lngarray[j]),
				new google.maps.LatLng(latarray[i], lngarray[j])
			];
			var bounds = new google.maps.LatLngBounds();
			for (k = 0; k < polygonCoords.length; k++) {
				bounds.extend(polygonCoords[k]);
			}
			var centroid = bounds.getCenter();
			var poly = new google.maps.Polygon({
				paths: polygonCoords,
				strokeColor: '#fff',
				strokeOpacity: 0.3,
				strokeWeight: 2,
				fillColor: '#000000',
				fillOpacity: 0,
				centroid: centroid
			});

			poly.setMap(map);
			cellarray.push(poly);
		}
	}
}

function automate(){
	play = setInterval(function(){randomCellGenerator()},100);
}

function stopautomate(){
	clearInterval(play);
}
function initialize() {

	var centerLatLng = new google.maps.LatLng(35.25707981912804, -120.7187989316406);

	var styles = 
	[
		{
			"stylers": 
			[
				{ "saturation": -100 }
			]
		}
	]

	map = new google.maps.Map(document.getElementById('map-canvas'), {
		center: centerLatLng,
		zoom: 11,
		mapTypeId: google.maps.MapTypeId.TERRAIN
	});
	map.setOptions({styles: styles});
	createGrid();

}

function randomCellGenerator(){
	randomCellID = Math.floor((Math.random()*celldivisions*celldivisions)+1);
	randomValue = Math.floor((Math.random()*60)+1);
	updateCell(randomCellID,randomValue);
}

function updateCell(cellid,value){

	if(value < 20)
	{
		var color = 'green';
	}
	else if (value >=20 && value < 40)
	{
		var color = 'yellow';
	}
	else if (value >=40 && value <= 60)
	{
		var color = 'red';
	}

	// can we drop the polygon from the sky?
	var marker = new google.maps.Marker({
		map:map,
		draggable:true,
		icon: {
			path: google.maps.SymbolPath.CIRCLE,
			scale: 15,
			fillColor: color,
			fillOpacity: 0.4,
			// scale: 1,
			strokeColor: color,
			strokeOpacity: 0.1,
			strokeWeight: 2
		},
		animation: google.maps.Animation.DROP,
		position: cellarray[cellid].centroid
	});

	markerarray.push(marker);

	// cellarray[cellid].setOptions({
	// 	fillOpacity:0.5,
	// 	fillColor: color,
	// })
}

function clearMap(){
	for(i in markerarray){markerarray[i].setMap(null)};
	// for(i in cellarray){cellarray[i].setMap(null)};

}
google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
    <div class="well" style="position: absolute;top:10px;left:80px;">
	    <button class="btn" onclick="automate()">automate</button>
	    <button class="btn" onclick="stopautomate()">stop</button>
	    <button class="btn" onclick="clearMap()">clear</button>
    </div>
  </body>
</html>